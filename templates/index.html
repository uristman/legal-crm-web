<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>‚öñÔ∏è Legal CRM Web - –°–∏—Å—Ç–µ–º–∞ –¥–ª—è —é—Ä–∏—Å—Ç–æ–≤</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- DataTables -->
    <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <!-- Flatpickr for date/time picking -->
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
    
    <script type="text/javascript" src="/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=IbFfmqjNQFNCz_VrDttV2jhn5ruUwIruJX-v8WERdbSfMnz6dAEm8dVvy6b62Wxv_S5tcGk5rEjNGUMjWoclvz_mj87K7En7GUYd4By3iZAXov-VUdlIMqACfZ_Rcn--IWQ-568w8z3YWda6Mo9eH77JZJq8aVBBvreTKltJRTU" charset="UTF-8"></script><link rel="stylesheet" crossorigin="anonymous" href="/E3E8934C-235A-4B0E-825A-35A08381A191/abn/main.css?attr=aHR0cHM6Ly9hZ2VudC5taW5pbWF4LmlvL21hdHJpeC9hcGkvdjEvc3RvcmFnZS9vYmplY3QvY2hhdC8zMzU0NTM5NjAwMjg0ODcvaW5kZXhfZml4ZWRfbW9iaWxlLmh0bWw"/><style>
        /* –ú–æ–±–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è */
        .mobile-stack {
            flex-direction: column;
        }
        
        .mobile-full-width {
            width: 100% !important;
            margin-bottom: 0.5rem;
        }
        
        .mobile-text-sm {
            font-size: 0.8rem;
        }
        
        .mobile-btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        
        @media (max-width: 768px) {
            .navbar-nav .nav-item {
                margin-bottom: 0.5rem;
            }
            
            .container-fluid {
                padding: 0.5rem !important;
            }
            
            .card {
                margin-bottom: 1rem;
            }
            
            .table-responsive {
                font-size: 0.9rem;
            }
            
            .btn {
                font-size: 0.9rem;
                padding: 0.375rem 0.75rem;
            }
            
            .modal-dialog {
                margin: 0.5rem;
            }
            
            .modal-body {
                padding: 1rem;
            }
            
            /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            .stats-mobile {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                margin-bottom: 1rem;
            }
            
            .stats-item {
                flex: 1;
                min-width: calc(50% - 0.25rem);
                background: #f8f9fa;
                padding: 0.5rem;
                border-radius: 0.375rem;
                text-align: center;
            }
            
            .stats-number {
                font-size: 1.2rem;
                font-weight: bold;
                color: #0d6efd;
            }
            
            .stats-label {
                font-size: 0.75rem;
                color: #6c757d;
                margin-top: 0.25rem;
            }
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ navbar –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        @media (max-width: 768px) {
            .navbar-nav .stats-container {
                display: none;
            }
            
            .navbar-brand {
                font-size: 1rem;
            }
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .h1, .h2, .h3, .h4, .h5, .h6, h1, h2, h3, h4, h5, h6 {
            line-height: 1.3;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .form-control, .form-select {
            font-size: 16px; /* –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç zoom –Ω–∞ iOS */
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .table {
            font-size: 0.85rem;
        }
        
        .table th, .table td {
            padding: 0.5rem 0.25rem;
        }
        
        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .btn-action {
            padding: 0.25rem 0.5rem;
            margin: 0.1rem;
        }
        
        /* Toast –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
        .toast {
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-balance-scale me-2"></i>
                Legal CRM Web
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav me-auto">
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ -->
                    <div class="d-flex align-items-center text-white me-4 stats-container">
                        <div class="me-3">
                            <small>–ö–ª–∏–µ–Ω—Ç—ã</small>
                            <div id="stats-clients" class="fw-bold">0</div>
                        </div>
                        <div class="me-3">
                            <small>–î–µ–ª–∞</small>
                            <div id="stats-cases" class="fw-bold">0</div>
                        </div>
                        <div class="me-3">
                            <small>–°–æ–±—ã—Ç–∏—è —Å–µ–≥–æ–¥–Ω—è</small>
                            <div id="stats-events" class="fw-bold">0</div>
                        </div>
                        <div>
                            <small>–î–æ—Ö–æ–¥ (–º–µ—Å—è—Ü)</small>
                            <div id="stats-income" class="fw-bold">0 ‚ÇΩ</div>
                        </div>
                    </div>
                </div>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –∏ –≤—ã—Ö–æ–¥ -->
                <div class="navbar-nav">
                    <div class="text-white me-3 d-none" id="userInfo">
                        <small>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</small>
                        <div id="userName" class="fw-bold"></div>
                    </div>
                    <button class="btn btn-outline-light btn-sm d-none" id="logoutBtn" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-1"></i>–í—ã–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="container-fluid py-3">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö -->
        <div class="stats-mobile d-lg-none" id="mobileStats" style="display: none;">
            <div class="stats-item">
                <div class="stats-number" id="mobile-clients">0</div>
                <div class="stats-label">–ö–ª–∏–µ–Ω—Ç—ã</div>
            </div>
            <div class="stats-item">
                <div class="stats-number" id="mobile-cases">0</div>
                <div class="stats-label">–î–µ–ª–∞</div>
            </div>
            <div class="stats-item">
                <div class="stats-number" id="mobile-events">0</div>
                <div class="stats-label">–°–æ–±—ã—Ç–∏—è</div>
            </div>
            <div class="stats-item">
                <div class="stats-number" id="mobile-income">0 ‚ÇΩ</div>
                <div class="stats-label">–î–æ—Ö–æ–¥</div>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∫–ª–∞–¥–∫–∞–º -->
        <ul class="nav nav-pills nav-fill mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="clients-tab" data-bs-toggle="pill" 
                        data-bs-target="#clients-panel" type="button" role="tab">
                    <i class="fas fa-users me-2"></i>–ö–ª–∏–µ–Ω—Ç—ã
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="cases-tab" data-bs-toggle="pill" 
                        data-bs-target="#cases-panel" type="button" role="tab">
                    <i class="fas fa-gavel me-2"></i>–î–µ–ª–∞
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="services-tab" data-bs-toggle="pill" 
                        data-bs-target="#services-panel" type="button" role="tab">
                    <i class="fas fa-briefcase me-2"></i>–£—Å–ª—É–≥–∏
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="payments-tab" data-bs-toggle="pill" 
                        data-bs-target="#payments-panel" type="button" role="tab">
                    <i class="fas fa-money-bill me-2"></i>–§–∏–Ω–∞–Ω—Å—ã
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="events-tab" data-bs-toggle="pill" 
                        data-bs-target="#events-panel" type="button" role="tab">
                    <i class="fas fa-calendar me-2"></i>–ö–∞–ª–µ–Ω–¥–∞—Ä—å
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reports-tab" data-bs-toggle="pill" 
                        data-bs-target="#reports-panel" type="button" role="tab">
                    <i class="fas fa-chart-bar me-2"></i>–û—Ç—á–µ—Ç—ã
                </button>
            </li>
        </ul>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tab-content" id="mainTabsContent">
            
            <!-- –í–∫–ª–∞–¥–∫–∞ –ö–ª–∏–µ–Ω—Ç—ã -->
            <div class="tab-pane fade show active" id="clients-panel" role="tabpanel">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-users me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
                        </h5>
                        <button class="btn btn-success" data-bs-toggle="modal" 
                                data-bs-target="#clientModal" onclick="openClientModal()">
                            <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- –ü–æ–∏—Å–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-search"></i>
                                    </span>
                                    <input type="text" class="form-control" id="clients-search" 
                                           placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ email">
                                </div>
                            </div>
                        </div>
                        
                        <!-- –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="clients-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>–§–ò–û</th>
                                        <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                        <th>Email</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –î–µ–ª–∞ -->
            <div class="tab-pane fade" id="cases-panel" role="tabpanel">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-gavel me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ–ª–∞–º–∏
                        </h5>
                        <button class="btn btn-success" data-bs-toggle="modal" 
                                data-bs-target="#caseModal" onclick="openCaseModal()">
                            <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –¥–µ–ª–æ
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="cases-table">
                                <thead>
                                    <tr>
                                        <th>–ù–æ–º–µ—Ä –¥–µ–ª–∞</th>
                                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                                        <th>–°—É–¥</th>
                                        <th>–¢–∏–ø –¥–µ–ª–∞</th>
                                        <th>–°—Ç–∞–¥–∏—è</th>
                                        <th>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –£—Å–ª—É–≥–∏ -->
            <div class="tab-pane fade" id="services-panel" role="tabpanel">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-briefcase me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏
                        </h5>
                        <button class="btn btn-success" data-bs-toggle="modal" 
                                data-bs-target="#serviceModal" onclick="openServiceModal()">
                            <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="services-table">
                                <thead>
                                    <tr>
                                        <th>–£—Å–ª—É–≥–∞</th>
                                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                                        <th>–î–µ–ª–æ</th>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–ß–∞—Å—ã</th>
                                        <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –§–∏–Ω–∞–Ω—Å—ã -->
            <div class="tab-pane fade" id="payments-panel" role="tabpanel">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-money-bill me-2"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞–º–∏
                        </h5>
                        <button class="btn btn-success" data-bs-toggle="modal" 
                                data-bs-target="#paymentModal" onclick="openPaymentModal()">
                            <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="payments-table">
                                <thead>
                                    <tr>
                                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                                        <th>–î–µ–ª–æ</th>
                                        <th>–°—É–º–º–∞</th>
                                        <th>–¢–∏–ø</th>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–°–ø–æ—Å–æ–±</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
            <div class="tab-pane fade" id="events-panel" role="tabpanel">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-calendar me-2"></i>–ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–æ–±—ã—Ç–∏–π
                        </h5>
                        <button class="btn btn-success" data-bs-toggle="modal" 
                                data-bs-target="#eventModal" onclick="openEventModal()">
                            <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="events-table">
                                <thead>
                                    <tr>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th>–¢–∏–ø</th>
                                        <th>–î–∞—Ç–∞</th>
                                        <th>–í—Ä–µ–º—è</th>
                                        <th>–ö–ª–∏–µ–Ω—Ç</th>
                                        <th>–î–µ–ª–æ</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –í–∫–ª–∞–¥–∫–∞ –û—Ç—á–µ—Ç—ã -->
            <div class="tab-pane fade" id="reports-panel" role="tabpanel">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar me-2"></i>–û—Ç—á–µ—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 col-6 mb-3">
                                <div class="card bg-primary text-white">
                                    <div class="card-body text-center">
                                        <h3 id="total-clients">0</h3>
                                        <p class="mb-0">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6 mb-3">
                                <div class="card bg-success text-white">
                                    <div class="card-body text-center">
                                        <h3 id="total-cases">0</h3>
                                        <p class="mb-0">–ê–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–ª</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6 mb-3">
                                <div class="card bg-info text-white">
                                    <div class="card-body text-center">
                                        <h3 id="total-income">0 ‚ÇΩ</h3>
                                        <p class="mb-0">–î–æ—Ö–æ–¥ –∑–∞ –º–µ—Å—è—Ü</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6 mb-3">
                                <div class="card bg-warning text-white">
                                    <div class="card-body text-center">
                                        <h3 id="total-services">0</h3>
                                        <p class="mb-0">–£—Å–ª—É–≥ –∑–∞ –º–µ—Å—è—Ü</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle me-2"></i>–§—É–Ω–∫—Ü–∏–∏ –æ—Ç—á–µ—Ç–æ–≤</h6>
                                    <p class="mb-0">–ü–æ–¥—Ä–æ–±–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö. –°–µ–π—á–∞—Å –¥–æ—Å—Ç—É–ø–Ω–∞ –±–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–ª–∏–µ–Ω—Ç–∞ -->
    <div class="modal fade" id="clientModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="clientModalTitle">
                        <i class="fas fa-user-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="clientForm">
                        <input type="hidden" id="clientId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–§–ò–û *</label>
                                <input type="text" class="form-control" id="clientFullName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                <input type="tel" class="form-control" id="clientPhone">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" id="clientEmail">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                                <select class="form-select" id="clientStatus">
                                    <option value="–ê–∫—Ç–∏–≤–Ω—ã–π">–ê–∫—Ç–∏–≤–Ω—ã–π</option>
                                    <option value="–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π</option>
                                    <option value="–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–ê–¥—Ä–µ—Å</label>
                                <input type="text" class="form-control" id="clientAddress">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–ü–∞—Å–ø–æ—Ä—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</label>
                                <input type="text" class="form-control" id="clientPassport">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–ò–ù–ù</label>
                                <input type="text" class="form-control" id="clientInn">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                            <textarea class="form-control" id="clientNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="saveClient()">
                        <i class="fas fa-save me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ–ª–∞ -->
    <div class="modal fade" id="caseModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="caseModalTitle">
                        <i class="fas fa-gavel me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –¥–µ–ª–æ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="caseForm">
                        <input type="hidden" id="caseId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–ö–ª–∏–µ–Ω—Ç *</label>
                                <select class="form-select" id="caseClientId" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–ù–æ–º–µ—Ä –¥–µ–ª–∞ *</label>
                                <input type="text" class="form-control" id="caseNumber" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–°—É–¥</label>
                                <input type="text" class="form-control" id="caseCourt">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–¢–∏–ø –¥–µ–ª–∞</label>
                                <input type="text" class="form-control" id="caseType">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–ò—Å—Ç–µ—Ü</label>
                                <input type="text" class="form-control" id="casePlaintiff">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–û—Ç–≤–µ—Ç—á–∏–∫</label>
                                <input type="text" class="form-control" id="caseDefendant">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–°—É–º–º–∞ –∏—Å–∫–∞</label>
                                <input type="number" class="form-control" id="caseClaimAmount" step="0.01">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–°—Ç–∞–¥–∏—è –¥–µ–ª–∞</label>
                                <input type="text" class="form-control" id="caseStage">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                            <textarea class="form-control" id="caseNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="saveCase()">
                        <i class="fas fa-save me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Å–ª—É–≥–∏ -->
    <div class="modal fade" id="serviceModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="serviceModalTitle">
                        <i class="fas fa-briefcase me-2"></i>–î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="serviceForm">
                        <input type="hidden" id="serviceId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–ö–ª–∏–µ–Ω—Ç *</label>
                                <select class="form-select" id="serviceClientId" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–¢–∏–ø —É—Å–ª—É–≥–∏ *</label>
                                <input type="text" class="form-control" id="serviceType" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea class="form-control" id="serviceDescription" rows="2"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label class="form-label">–î–∞—Ç–∞ —É—Å–ª—É–≥–∏</label>
                                <input type="date" class="form-control" id="serviceDate">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">–ß–∞—Å—ã</label>
                                <input type="number" class="form-control" id="serviceHours" step="0.5" min="0">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</label>
                                <input type="number" class="form-control" id="serviceCost" step="0.01" min="0">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                            <textarea class="form-control" id="serviceNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="saveService()">
                        <i class="fas fa-save me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–ª–∞—Ç–µ–∂–∞ -->
    <div class="modal fade" id="paymentModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="paymentModalTitle">
                        <i class="fas fa-money-bill me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="paymentForm">
                        <input type="hidden" id="paymentId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–ö–ª–∏–µ–Ω—Ç *</label>
                                <select class="form-select" id="paymentClientId" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–°—É–º–º–∞ *</label>
                                <input type="number" class="form-control" id="paymentAmount" step="0.01" min="0" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–¢–∏–ø –ø–ª–∞—Ç–µ–∂–∞</label>
                                <select class="form-select" id="paymentType">
                                    <option value="–û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥">–û–ø–ª–∞—Ç–∞ —É—Å–ª—É–≥</option>
                                    <option value="–ê–≤–∞–Ω—Å">–ê–≤–∞–Ω—Å</option>
                                    <option value="–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</option>
                                    <option value="–ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ">–ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–î–∞—Ç–∞ –ø–ª–∞—Ç–µ–∂–∞</label>
                                <input type="date" class="form-control" id="paymentDate">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</label>
                                <select class="form-select" id="paymentMethod">
                                    <option value="–ù–∞–ª–∏—á–Ω—ã–µ">–ù–∞–ª–∏—á–Ω—ã–µ</option>
                                    <option value="–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥</option>
                                    <option value="–ö–∞—Ä—Ç–∞">–ö–∞—Ä—Ç–∞</option>
                                    <option value="–°–±–µ—Ä–±–∞–Ω–∫ –û–Ω–ª–∞–π–Ω">–°–±–µ—Ä–±–∞–Ω–∫ –û–Ω–ª–∞–π–Ω</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–ù–æ–º–µ—Ä —Å—á–µ—Ç–∞/–∫–≤–∏—Ç–∞–Ω—Ü–∏–∏</label>
                                <input type="text" class="form-control" id="paymentInvoice">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ü—Ä–∏–º–µ—á–∞–Ω–∏—è</label>
                            <textarea class="form-control" id="paymentNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="savePayment()">
                        <i class="fas fa-save me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–±—ã—Ç–∏—è -->
    <div class="modal fade" id="eventModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventModalTitle">
                        <i class="fas fa-calendar me-2"></i>–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="eventForm">
                        <input type="hidden" id="eventId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è *</label>
                                <input type="text" class="form-control" id="eventTitle" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–¢–∏–ø —Å–æ–±—ã—Ç–∏—è *</label>
                                <select class="form-select" id="eventType" required>
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                                    <option value="–°—É–¥–µ–±–Ω–æ–µ –∑–∞—Å–µ–¥–∞–Ω–∏–µ">–°—É–¥–µ–±–Ω–æ–µ –∑–∞—Å–µ–¥–∞–Ω–∏–µ</option>
                                    <option value="–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</option>
                                    <option value="–í—Å—Ç—Ä–µ—á–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–º">–í—Å—Ç—Ä–µ—á–∞ —Å –∫–ª–∏–µ–Ω—Ç–æ–º</option>
                                    <option value="–î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç">–î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç</option>
                                    <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–ö–ª–∏–µ–Ω—Ç</label>
                                <select class="form-select" id="eventClient">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–î–µ–ª–æ</label>
                                <select class="form-select" id="eventCase">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–ª–æ</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–î–∞—Ç–∞ *</label>
                                <input type="date" class="form-control" id="eventDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">–í—Ä–µ–º—è</label>
                                <input type="time" class="form-control" id="eventTime">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è</label>
                            <input type="text" class="form-control" id="eventLocation">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="button" class="btn btn-primary" onclick="saveEvent()">
                        <i class="fas fa-save me-2"></i>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="notificationToast" class="toast" role="alert">
            <div class="toast-header">
                <i class="fas fa-info-circle me-2"></i>
                <strong class="me-auto">Legal CRM</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ru.js"></script>
    
    <script>
        // Legal CRM Web - –û—Å–Ω–æ–≤–Ω–æ–π JavaScript —Ñ–∞–π–ª
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let clientsDataTable, casesDataTable, servicesDataTable, paymentsDataTable, eventsDataTable;
        let currentEditingId = null;
        let currentUser = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        $(document).ready(function() {
            console.log('üöÄ Legal CRM Web –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...');
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
            checkAuthentication();
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        async function checkAuthentication() {
            try {
                const response = await fetch('/api/auth/check');
                const data = await response.json();
                
                if (data.authenticated) {
                    currentUser = data.user;
                    showUserInterface();
                } else {
                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
                    window.location.href = '/login';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
                window.location.href = '/login';
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—Å–ª–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
        function showUserInterface() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            $('#userInfo').removeClass('d-none');
            $('#logoutBtn').removeClass('d-none');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            $('#userName').text(currentUser.username);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
            initializeComponents();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            loadAllData();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            updateStatistics();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
            initializeSearch();
            
            console.log('‚úÖ Legal CRM Web –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');
        }

        // –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
        async function logout() {
            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 1000);
                } else {
                    showNotification('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'error');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É', 'error');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        function initializeComponents() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DateTime picker
            flatpickr("input[type='date']", {
                locale: "ru",
                dateFormat: "Y-m-d",
                allowInput: true
            });
            
            flatpickr("input[type='time']", {
                locale: "ru",
                enableTime: true,
                noCalendar: true,
                dateFormat: "H:i",
                allowInput: true
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Bootstrap tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Å–æ–±—ã—Ç–∏–∏
            $(document).on('change', '#eventClient', function() {
                const clientId = $(this).val();
                loadCasesForClient(clientId);
            });

            // –ú–æ–±–∏–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
            if (window.innerWidth <= 768) {
                $('#mobileStats').show();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
        function loadAllData() {
            loadClients();
            loadCases();
            loadServices();
            loadPayments();
            loadEvents();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
        function loadClients() {
            $.ajax({
                url: '/api/clients',
                method: 'GET',
                success: function(response) {
                    // Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {success: true, data: clients}
                    if (response.success) {
                        displayClients(response.data);
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤: ' + response.error, 'error');
                    }
                },
                error: function(xhr, status, error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:', error);
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                }
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
        function displayClients(clients) {
            if (clientsDataTable) {
                clientsDataTable.destroy();
            }
            
            const tbody = $('#clients-table tbody');
            tbody.empty();
            
            clients.forEach(function(client) {
                const row = `
                    <tr>
                        <td>${client.id}</td>
                        <td>${client.full_name || client.name || '-'}</td>
                        <td>${client.phone || '-'}</td>
                        <td>${client.email || '-'}</td>
                        <td><span class="badge bg-${(client.status === '–ê–∫—Ç–∏–≤–Ω—ã–π' || client.status === 'active') ? 'success' : 'secondary'}">${client.status || '–ê–∫—Ç–∏–≤–Ω—ã–π'}</span></td>
                        <td>${formatDate(client.created_date || client.created_at)}</td>
                        <td>
                            <div class="btn-group" role="group">
                                <button class="btn btn-sm btn-primary btn-action" onclick="editClient(${client.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger btn-action" onclick="deleteClient(${client.id})" title="–£–¥–∞–ª–∏—Ç—å">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.append(row);
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DataTable
            clientsDataTable = $('#clients-table').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/Russian.json'
                },
                pageLength: 25,
                responsive: true
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–µ–ª
        function loadCases() {
            $.ajax({
                url: '/api/cases',
                method: 'GET',
                success: function(response) {
                    if (response.success) {
                        displayCases(response.data);
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ–ª: ' + response.error, 'error');
                    }
                },
                error: function() {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ–ª');
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                }
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ–ª
        function displayCases(cases) {
            if (casesDataTable) {
                casesDataTable.destroy();
            }
            
            const tbody = $('#cases-table tbody');
            tbody.empty();
            
            cases.forEach(function(case_item) {
                const row = `
                    <tr>
                        <td>${case_item.case_number || '-'}</td>
                        <td>${case_item.client_name || '-'}</td>
                        <td>${case_item.court_name || '-'}</td>
                        <td>${case_item.case_type || '-'}</td>
                        <td>${case_item.case_stage || '-'}</td>
                        <td>${formatDate(case_item.start_date)}</td>
                        <td><span class="badge bg-${(case_item.status === '–ê–∫—Ç–∏–≤–Ω–æ–µ' || case_item.status === 'active') ? 'success' : 'secondary'}">${case_item.status || '–ê–∫—Ç–∏–≤–Ω–æ–µ'}</span></td>
                        <td>
                            <div class="btn-group" role="group">
                                <button class="btn btn-sm btn-primary btn-action" onclick="editCase(${case_item.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger btn-action" onclick="deleteCase(${case_item.id})" title="–£–¥–∞–ª–∏—Ç—å">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.append(row);
            });
            
            casesDataTable = $('#cases-table').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/Russian.json'
                },
                pageLength: 25,
                responsive: true
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥
        function loadServices() {
            $.ajax({
                url: '/api/services',
                method: 'GET',
                success: function(response) {
                    if (response.success) {
                        displayServices(response.data);
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å–ª—É–≥: ' + response.error, 'error');
                    }
                },
                error: function() {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Å–ª—É–≥');
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                }
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ª—É–≥
        function displayServices(services) {
            if (servicesDataTable) {
                servicesDataTable.destroy();
            }
            
            const tbody = $('#services-table tbody');
            tbody.empty();
            
            services.forEach(function(service) {
                const row = `
                    <tr>
                        <td>${service.service_type || '-'}</td>
                        <td>${service.client_name || '-'}</td>
                        <td>${service.case_number || '-'}</td>
                        <td>${formatDate(service.service_date)}</td>
                        <td>${service.hours || 0}</td>
                        <td>${formatCurrency(service.cost)}</td>
                        <td>
                            <button class="btn btn-sm btn-danger btn-action" onclick="deleteService(${service.id})" title="–£–¥–∞–ª–∏—Ç—å">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.append(row);
            });
            
            servicesDataTable = $('#services-table').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/Russian.json'
                },
                pageLength: 25,
                responsive: true
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
        function loadPayments() {
            $.ajax({
                url: '/api/payments',
                method: 'GET',
                success: function(response) {
                    // Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {success: true, data: payments}
                    if (response.success) {
                        displayPayments(response.data);
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π: ' + response.error, 'error');
                    }
                },
                error: function() {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π');
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                }
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π
        function displayPayments(payments) {
            if (paymentsDataTable) {
                paymentsDataTable.destroy();
            }
            
            const tbody = $('#payments-table tbody');
            tbody.empty();
            
            payments.forEach(function(payment) {
                const row = `
                    <tr>
                        <td>${payment.client_name || '-'}</td>
                        <td>${payment.case_number || '-'}</td>
                        <td><strong>${formatCurrency(payment.amount)}</strong></td>
                        <td>${payment.payment_type || '-'}</td>
                        <td>${formatDate(payment.payment_date)}</td>
                        <td>${payment.payment_method || '-'}</td>
                        <td><span class="badge bg-${(payment.status === '–û–ø–ª–∞—á–µ–Ω–æ' || payment.status === 'paid') ? 'success' : 'warning'}">${payment.status || '–û–ø–ª–∞—á–µ–Ω–æ'}</span></td>
                        <td>
                            <button class="btn btn-sm btn-danger btn-action" onclick="deletePayment(${payment.id})" title="–£–¥–∞–ª–∏—Ç—å">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.append(row);
            });
            
            paymentsDataTable = $('#payments-table').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/Russian.json'
                },
                pageLength: 25,
                responsive: true
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
        function loadEvents() {
            $.ajax({
                url: '/api/events',
                method: 'GET',
                success: function(response) {
                    if (response.success) {
                        displayEvents(response.data);
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π: ' + response.error, 'error');
                    }
                },
                error: function() {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π');
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                }
            });
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π
        function displayEvents(events) {
            if (eventsDataTable) {
                eventsDataTable.destroy();
            }
            
            const tbody = $('#events-table tbody');
            tbody.empty();
            
            events.forEach(function(event) {
                const row = `
                    <tr>
                        <td>${event.title || '-'}</td>
                        <td>${event.event_type || '-'}</td>
                        <td>${formatDate(event.event_date)}</td>
                        <td>${event.event_time || '-'}</td>
                        <td>${event.client_name || '-'}</td>
                        <td>${event.case_number || '-'}</td>
                        <td><span class="badge bg-${getEventStatusColor(event.status)}">${event.status || '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ'}</span></td>
                        <td>
                            <div class="btn-group" role="group">
                                <button class="btn btn-sm btn-primary btn-action" onclick="editEvent(${event.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger btn-action" onclick="deleteEvent(${event.id})" title="–£–¥–∞–ª–∏—Ç—å">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.append(row);
            });
            
            eventsDataTable = $('#events-table').DataTable({
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/Russian.json'
                },
                pageLength: 25,
                responsive: true
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStatistics() {
            $.ajax({
                url: '/api/statistics',
                method: 'GET',
                success: function(response) {
                    // Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {success: true, data: stats}
                    if (response.success) {
                        const stats = response.data;
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    $('#stats-clients').text(stats.active_clients || 0);
                    $('#stats-cases').text(stats.active_cases || 0);
                    $('#stats-events').text(stats.today_events || 0);
                        $('#stats-income').text(formatCurrency(stats.month_payments || 0));
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –º–æ–±–∏–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                        $('#mobile-clients').text(stats.active_clients || 0);
                        $('#mobile-cases').text(stats.active_cases || 0);
                        $('#mobile-events').text(stats.today_events || 0);
                        $('#mobile-income').text(formatCurrency(stats.month_payments || 0));
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ –æ—Ç—á–µ—Ç–∞—Ö
                        $('#total-clients').text(stats.active_clients || 0);
                        $('#total-cases').text(stats.active_cases || 0);
                        $('#total-income').text(formatCurrency(stats.month_payments || 0));
                        $('#total-services').text(stats.month_services || 0);
                    } else {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', response.error);
                    }
                },
                error: function() {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏');
                }
            });
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –ö–õ–ò–ï–ù–¢–û–í ====================

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞
        function openClientModal(clientId = null) {
            currentEditingId = clientId;
            
            if (clientId) {
                $('#clientModalTitle').html('<i class="fas fa-user-edit me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
                $.ajax({
                    url: `/api/clients/${clientId}`,
                    method: 'GET',
                    success: function(response) {
                        const client = response;
                        $('#clientId').val(client.id);
                        $('#clientFullName').val(client.full_name || client.name || '');
                        $('#clientPhone').val(client.phone || '');
                        $('#clientEmail').val(client.email || '');
                        $('#clientAddress').val(client.address || '');
                        $('#clientPassport').val(client.passport_data || client.passport || '');
                        $('#clientInn').val(client.inn || '');
                        $('#clientStatus').val(client.status || '–ê–∫—Ç–∏–≤–Ω—ã–π');
                        $('#clientNotes').val(client.notes || '');
                    }
                });
            } else {
                $('#clientModalTitle').html('<i class="fas fa-user-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞');
                $('#clientForm')[0].reset();
                $('#clientId').val('');
            }
            
            $('#clientModal').modal('show');
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
        function saveClient() {
            const formData = {
                name: $('#clientFullName').val().trim(),
                phone: $('#clientPhone').val().trim(),
                email: $('#clientEmail').val().trim(),
                address: $('#clientAddress').val().trim(),
                notes: $('#clientNotes').val().trim()
            };
            
            if (!formData.name) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –§–ò–û –∫–ª–∏–µ–Ω—Ç–∞', 'error');
                return;
            }
            
            const method = currentEditingId ? 'PUT' : 'POST';
            const url = currentEditingId ? `/api/clients/${currentEditingId}` : '/api/clients';
            
            $.ajax({
                url: url,
                method: method,
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function(response) {
                    showNotification(currentEditingId ? '–ö–ª–∏–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω!' : '–ö–ª–∏–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    $('#clientModal').modal('hide');
                    loadClients();
                    updateStatistics();
                },
                error: function() {
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                }
            });
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
        function editClient(clientId) {
            openClientModal(clientId);
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
        function deleteClient(clientId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞? –í—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–∞–∫–∂–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.')) {
                $.ajax({
                    url: `/api/clients/${clientId}`,
                    method: 'DELETE',
                    success: function(response) {
                        showNotification('–ö–ª–∏–µ–Ω—Ç —É–¥–∞–ª–µ–Ω!', 'success');
                        loadClients();
                        updateStatistics();
                    },
                    error: function() {
                        showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                    }
                });
            }
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –ü–õ–ê–¢–ï–ñ–ï–ô ====================

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–ª–∞—Ç–µ–∂–∞
        function openPaymentModal(paymentId = null) {
            currentEditingId = paymentId;
            
            if (paymentId) {
                $('#paymentModalTitle').html('<i class="fas fa-money-bill me-2"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂');
            } else {
                $('#paymentModalTitle').html('<i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂');
                $('#paymentForm')[0].reset();
                $('#paymentId').val('');
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
            loadClientsForSelect('#paymentClientId');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É
            if (!paymentId) {
                $('#paymentDate').val(new Date().toISOString().split('T')[0]);
            }
            
            $('#paymentModal').modal('show');
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
        function savePayment() {
            const formData = {
                client_id: parseInt($('#paymentClientId').val()),
                amount: parseFloat($('#paymentAmount').val()),
                payment_type: $('#paymentType').val(),
                payment_date: $('#paymentDate').val(),
                payment_method: $('#paymentMethod').val(),
                notes: $('#paymentNotes').val().trim()
            };
            
            if (!formData.client_id || !formData.amount) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            const method = currentEditingId ? 'PUT' : 'POST';
            const url = currentEditingId ? `/api/payments/${currentEditingId}` : '/api/payments';
            
            $.ajax({
                url: url,
                method: method,
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function(response) {
                    showNotification(currentEditingId ? '–ü–ª–∞—Ç–µ–∂ –æ–±–Ω–æ–≤–ª–µ–Ω!' : '–ü–ª–∞—Ç–µ–∂ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    $('#paymentModal').modal('hide');
                    loadPayments();
                    updateStatistics();
                },
                error: function() {
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                }
            });
        }

        // ==================== –£–¢–ò–õ–ò–¢–´ ====================

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
        function loadClientsForSelect(selectId) {
            $.ajax({
                url: '/api/clients',
                method: 'GET',
                success: function(response) {
                    const select = $(selectId);
                    select.empty();
                    select.append('<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞</option>');
                    
                    if (response.success) {
                        response.data.forEach(function(client) {
                            select.append(`<option value="${client.id}">${client.full_name || client.name}</option>`);
                        });
                    }
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞
        function initializeSearch() {
            $('#clients-search').on('keyup', function() {
                if (clientsDataTable) {
                    clientsDataTable.search($(this).val()).draw();
                }
            });
        }

        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        function showNotification(message, type = 'info') {
            const toast = $('#notificationToast');
            const toastMessage = $('#toastMessage');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            toastMessage.text(message);
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            const header = toast.find('.toast-header');
            header.removeClass('bg-success bg-warning bg-danger bg-info');
            
            switch(type) {
                case 'success':
                    header.addClass('bg-success');
                    break;
                case 'error':
                    header.addClass('bg-danger');
                    break;
                case 'warning':
                    header.addClass('bg-warning');
                    break;
                default:
                    header.addClass('bg-info');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º toast
            const bsToast = new bootstrap.Toast(toast[0]);
            bsToast.show();
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
        function formatDate(dateString) {
            if (!dateString) return '-';
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return dateString;
            
            return date.toLocaleDateString('ru-RU');
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã
        function formatCurrency(amount) {
            if (amount === null || amount === undefined || isNaN(amount)) return '0 ‚ÇΩ';
            
            return new Intl.NumberFormat('ru-RU', {
                style: 'currency',
                currency: 'RUB',
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            }).format(amount);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–±—ã—Ç–∏—è
        function getEventStatusColor(status) {
            switch(status) {
                case '–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ':
                    return 'primary';
                case '–ó–∞–≤–µ—Ä—à–µ–Ω–æ':
                    return 'success';
                case '–û—Ç–º–µ–Ω–µ–Ω–æ':
                    return 'danger';
                default:
                    return 'secondary';
            }
        }

        // ==================== PLACEHOLDER FUNCTIONS ====================
        // –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –∫–Ω–æ–ø–∫–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é

        function openCaseModal(caseId = null) {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function saveCase() {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function editCase(caseId) {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function openServiceModal(serviceId = null) {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function saveService() {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function openEventModal(eventId = null) {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function saveEvent() {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function editEvent(eventId) {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function deleteCase(caseId) {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function deleteService(serviceId) {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function deleteEvent(eventId) {
            showNotification('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'warning');
        }

        function deletePayment(paymentId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–ª–∞—Ç–µ–∂?')) {
                $.ajax({
                    url: `/api/payments/${paymentId}`,
                    method: 'DELETE',
                    success: function(response) {
                        showNotification('–ü–ª–∞—Ç–µ–∂ —É–¥–∞–ª–µ–Ω!', 'success');
                        loadPayments();
                        updateStatistics();
                    },
                    error: function() {
                        showNotification('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                    }
                });
            }
        }
    </script>
</body>
</html>
