{% extends "mobile-base.html" %}

{% block title %}–í—Ö–æ–¥ - Legal CRM{% endblock %}

{% block content %}
<div class="container-narrow animate-slide-up">
    <div class="text-center mb-6">
        <div style="font-size: 2rem; color: var(--primary-color); margin-bottom: 0.5rem;">‚öñÔ∏è</div>
        <h1 class="text-2xl font-bold mb-2">Legal CRM</h1>
        <p class="text-muted">–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</p>
    </div>

    <div class="card">
        <div class="card-body">
            <form method="POST" action="{{ url_for('login') }}" novalidate>
                <div class="form-group">
                    <label for="username" class="form-label">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    </label>
                    <input 
                        type="text" 
                        class="form-input" 
                        id="username" 
                        name="username" 
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω"
                        required
                        autocomplete="username"
                        inputmode="text"
                    >
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <circle cx="12" cy="16" r="1"></circle>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                        –ü–∞—Ä–æ–ª—å
                    </label>
                    <div style="position: relative;">
                        <input 
                            type="password" 
                            class="form-input" 
                            id="password" 
                            name="password" 
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                            required
                            autocomplete="current-password"
                            inputmode="text"
                        >
                        <button 
                            type="button" 
                            class="mobile-nav-toggle" 
                            onclick="togglePassword()"
                            style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%);"
                            aria-label="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å"
                        >
                            <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input 
                            type="checkbox" 
                            name="remember_me" 
                            style="width: auto; margin: 0;"
                        >
                        <span class="text-sm">–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è</span>
                    </label>
                </div>

                <button type="submit" class="btn btn-primary btn-full" onclick="showLoading()">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12h18"></path>
                        <path d="M15 8l-3-3-3 3"></path>
                        <path d="M15 8v8"></path>
                    </svg>
                    –í–æ–π—Ç–∏
                </button>
            </form>
        </div>
        
        <div class="card-footer">
            <div class="text-center">
                <p class="text-xs text-muted mb-4">
                    –ï—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –≤—Ö–æ–¥–æ–º?
                </p>
                
                <div class="mobile-grid">
                    <a href="mailto:admin@legal-crm.com" class="btn btn-outline" style="text-decoration: none;">
                        <svg class="icon-sm" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                        –°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
                    </a>
                </div>
                
                <div class="mt-4">
                    <p class="text-xs text-muted">
                        Legal CRM v2.0 ‚Ä¢ –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Help -->
    <div class="card mt-4">
        <div class="card-body">
            <h3 class="font-semibold mb-3 text-center">üîê –î–µ–º–æ-–¥–æ—Å—Ç—É–ø</h3>
            <div class="mobile-grid">
                <div class="chip">admin / admin123</div>
            </div>
            <p class="text-xs text-muted mt-3 text-center">
                –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
            </p>
        </div>
    </div>

    <!-- App Download Suggestions -->
    <div class="mt-6 text-center">
        <p class="text-sm text-muted mb-3">üí° –ú–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:</p>
        <div class="mobile-grid-2">
            <a href="#" class="chip" onclick="showInstallInstructions('iOS')">
                üì± iOS Safari
            </a>
            <a href="#" class="chip" onclick="showInstallInstructions('Android')">
                ü§ñ Android Chrome
            </a>
        </div>
    </div>
</div>

<!-- Install Instructions Modal -->
<div id="install-modal" class="mobile-menu-overlay" style="display: none;" onclick="closeInstallModal()">
    <div class="card" style="margin: 2rem; max-width: 400px;" onclick="event.stopPropagation()">
        <div class="card-body">
            <h3 class="font-semibold mb-3 text-center" id="install-title">üì± –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ iOS</h3>
            <div id="install-content" class="text-sm">
                <!-- Content will be populated by JavaScript -->
            </div>
            <button class="btn btn-primary btn-full mt-4" onclick="closeInstallModal()">
                –ü–æ–Ω—è—Ç–Ω–æ
            </button>
        </div>
    </div>
</div>

<style>
/* Login page specific styles */
.form-input {
    font-size: 16px; /* Prevents zoom on iOS */
}

@media (max-width: 480px) {
    .container-narrow {
        padding: 1rem 0.75rem;
    }
    
    .card {
        border-radius: 8px;
        border: none;
        box-shadow: none;
    }
    
    .card-body {
        padding: 1.5rem 1rem;
    }
    
    .card-footer {
        padding: 1rem;
        background: none;
        border-top: 1px solid var(--border-color);
    }
}

/* Loading state */
.btn.loading {
    pointer-events: none;
    opacity: 0.7;
}

.btn.loading::after {
    content: '';
    width: 16px;
    height: 16px;
    border: 2px solid transparent;
    border-top: 2px solid currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-left: 0.5rem;
}

/* Install modal animation */
#install-modal {
    animation: fadeIn 0.3s ease-out;
}

#install-modal .card {
    animation: slideInUp 0.3s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideInUp {
    from { 
        transform: translateY(20px);
        opacity: 0;
    }
    to { 
        transform: translateY(0);
        opacity: 1;
    }
}
</style>

<script>
let passwordVisible = false;

function togglePassword() {
    const passwordInput = document.getElementById('password');
    const toggleButton = event.target.closest('button');
    
    passwordVisible = !passwordVisible;
    passwordInput.type = passwordVisible ? 'text' : 'password';
    
    const icon = toggleButton.querySelector('svg');
    icon.innerHTML = passwordVisible 
        ? '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>'
        : '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
}

function showLoading() {
    const submitBtn = event.target.closest('button[type="submit"]');
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
    
    // Remove loading state after 10 seconds as fallback
    setTimeout(() => {
        submitBtn.classList.remove('loading');
        submitBtn.disabled = false;
    }, 10000);
}

function showInstallInstructions(platform) {
    const modal = document.getElementById('install-modal');
    const title = document.getElementById('install-title');
    const content = document.getElementById('install-content');
    
    if (platform === 'iOS') {
        title.innerHTML = 'üì± –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ iPhone/iPad';
        content.innerHTML = `
            <ol style="padding-left: 1.25rem; line-height: 1.6;">
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ Safari</li>
                <li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" üì§</li>
                <li>–ü—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ –≤–Ω–∏–∑ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ "–ù–∞ —ç–∫—Ä–∞–Ω ¬´–î–æ–º–æ–π¬ª"</li>
                <li>–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å" –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏</li>
            </ol>
            <p class="text-muted mt-3">
                –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ –∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –Ω–∞—Ç–∏–≤–Ω–æ–µ.
            </p>
        `;
    } else if (platform === 'Android') {
        title.innerHTML = 'ü§ñ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ Android';
        content.innerHTML = `
            <ol style="padding-left: 1.25rem; line-height: 1.6;">
                <li>–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ Chrome</li>
                <li>–í —Å—Ç—Ä–æ–∫–µ –∞–¥—Ä–µ—Å–∞ –Ω–∞–∂–º–∏—Ç–µ "‚ãÆ" (—Ç—Ä–∏ —Ç–æ—á–∫–∏)</li>
                <li>–í—ã–±–µ—Ä–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω"</li>
                <li>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É</li>
            </ol>
            <p class="text-muted mt-3">
                –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Android.
            </p>
        `;
    }
    
    modal.style.display = 'block';
    modal.classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeInstallModal() {
    const modal = document.getElementById('install-modal');
    modal.style.display = 'none';
    modal.classList.remove('active');
    document.body.style.overflow = '';
}

// Enhanced form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    
    if (!username || !password) {
        e.preventDefault();
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
        return;
    }
    
    if (username.length < 3) {
        e.preventDefault();
        alert('–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞');
        return;
    }
});

// Add haptic feedback on iOS
if (navigator.vibrate) {
    document.querySelectorAll('button, .btn').forEach(element => {
        element.addEventListener('click', () => {
            navigator.vibrate(10);
        });
    });
}

// Auto-focus username field
document.addEventListener('DOMContentLoaded', function() {
    const usernameField = document.getElementById('username');
    if (usernameField && !usernameField.value) {
        usernameField.focus();
    }
});
</script>
{% endblock %}
